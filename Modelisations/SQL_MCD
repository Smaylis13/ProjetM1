# script créé le : Mon May 04 15:42:45 CEST 2015 -   syntaxe MySQL ;

# use  VOTRE_BASE_DE_DONNEE ;

DROP TABLE IF EXISTS USER ;
CREATE TABLE USER (ID_USER int AUTO_INCREMENT NOT NULL,
MAIL VARCHAR(50),
PASSWORD VARCHAR(20),
PRIMARY KEY (ID_USER) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS VOTE ;
CREATE TABLE VOTE (ID_VOTE int AUTO_INCREMENT NOT NULL,
NOM_VOTE VARCHAR(20),
DESCRIPTION_VOTE LONGTEXT,
DATE_START_VOTE DATE,
DATE_VOTE_END DATE,
RESULT_VOTE LONGTEXT,
STATUT_VOTE VARCHAR(20),
ID_USER INT NOT NULL,
PRIMARY KEY (ID_VOTE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS RULE ;
CREATE TABLE RULE (ID_RULE int AUTO_INCREMENT NOT NULL,
DESCRIPTION_RULE LONGTEXT,
PRIMARY KEY (ID_RULE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS CANDIDATE ;
CREATE TABLE CANDIDATE (ID_CANDIDATE int AUTO_INCREMENT NOT NULL,
NOM_CANDIDATE VARCHAR(20),
DESCRIPTION_CANDIDATE LONGTEXT,
ID_VOTE INT NOT NULL,
PRIMARY KEY (ID_CANDIDATE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS GROUP ;
CREATE TABLE GROUP (ID-GROUP int AUTO_INCREMENT NOT NULL,
NOM_GROUP VARCHAR(20),
DESCRIPTION_GROUP LONGTEXT,
PRIMARY KEY (ID-GROUP) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS TYPE ;
CREATE TABLE TYPE (ID_TYPE int AUTO_INCREMENT NOT NULL,
NOM_TYPE VARCHAR(20),
DESCRIPTION_TYPE TEXT,
PRIMARY KEY (ID_TYPE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS PROCURATION ;
CREATE TABLE PROCURATION (ID_USER1 BIGINT NOT NULL,
ID_USER2 BIGINT,
ID_VOTE INT NOT NULL,
PRIMARY KEY (ID_USER1) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS PARTICIPATE ;
CREATE TABLE PARTICIPATE (ID_VOTE int AUTO_INCREMENT NOT NULL,
ID_USER INT NOT NULL,
CHOIX TEXT,
PRIMARY KEY (ID_VOTE,
 ID_USER) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS SETUP ;
CREATE TABLE SETUP (ID_VOTE int AUTO_INCREMENT NOT NULL,
ID_RULE INT NOT NULL,
PRIMARY KEY (ID_VOTE,
 ID_RULE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS HAS ;
CREATE TABLE HAS (ID_USER int AUTO_INCREMENT NOT NULL,
ID_USER_HAS INT,
PRIMARY KEY (ID_USER) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS BELONGS ;
CREATE TABLE BELONGS (ID_USER int AUTO_INCREMENT NOT NULL,
ID-GROUP INT NOT NULL,
PRIMARY KEY (ID_USER,
 ID-GROUP) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS CERTIFIE ;
CREATE TABLE CERTIFIE (ID_VOTE int AUTO_INCREMENT NOT NULL,
ID_TYPE INT NOT NULL,
PRIMARY KEY (ID_VOTE,
 ID_TYPE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS AUTORISER ;
CREATE TABLE AUTORISER (ID_RULE int AUTO_INCREMENT NOT NULL,
ID_TYPE INT NOT NULL,
PRIMARY KEY (ID_RULE,
 ID_TYPE) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS Association_26 ;
CREATE TABLE Association_26 (ID_USER int AUTO_INCREMENT NOT NULL,
ID_USER1 BIGINT NOT NULL,
PRIMARY KEY (ID_USER,
 ID_USER1) ) ENGINE=InnoDB;

ALTER TABLE VOTE ADD CONSTRAINT FK_VOTE_ID_USER FOREIGN KEY (ID_USER) REFERENCES USER (ID_USER);

ALTER TABLE CANDIDATE ADD CONSTRAINT FK_CANDIDATE_ID_VOTE FOREIGN KEY (ID_VOTE) REFERENCES VOTE (ID_VOTE);
ALTER TABLE PROCURATION ADD CONSTRAINT FK_PROCURATION_ID_VOTE FOREIGN KEY (ID_VOTE) REFERENCES VOTE (ID_VOTE);
ALTER TABLE PARTICIPATE ADD CONSTRAINT FK_PARTICIPATE_ID_VOTE FOREIGN KEY (ID_VOTE) REFERENCES VOTE (ID_VOTE);
ALTER TABLE PARTICIPATE ADD CONSTRAINT FK_PARTICIPATE_ID_USER FOREIGN KEY (ID_USER) REFERENCES USER (ID_USER);
ALTER TABLE SETUP ADD CONSTRAINT FK_SETUP_ID_VOTE FOREIGN KEY (ID_VOTE) REFERENCES VOTE (ID_VOTE);
ALTER TABLE SETUP ADD CONSTRAINT FK_SETUP_ID_RULE FOREIGN KEY (ID_RULE) REFERENCES RULE (ID_RULE);
ALTER TABLE HAS ADD CONSTRAINT FK_HAS_ID_USER FOREIGN KEY (ID_USER) REFERENCES USER (ID_USER);
ALTER TABLE BELONGS ADD CONSTRAINT FK_BELONGS_ID_USER FOREIGN KEY (ID_USER) REFERENCES USER (ID_USER);
ALTER TABLE BELONGS ADD CONSTRAINT FK_BELONGS_ID-GROUP FOREIGN KEY (ID-GROUP) REFERENCES GROUP (ID-GROUP);
ALTER TABLE CERTIFIE ADD CONSTRAINT FK_CERTIFIE_ID_VOTE FOREIGN KEY (ID_VOTE) REFERENCES VOTE (ID_VOTE);
ALTER TABLE CERTIFIE ADD CONSTRAINT FK_CERTIFIE_ID_TYPE FOREIGN KEY (ID_TYPE) REFERENCES TYPE (ID_TYPE);
ALTER TABLE AUTORISER ADD CONSTRAINT FK_AUTORISER_ID_RULE FOREIGN KEY (ID_RULE) REFERENCES RULE (ID_RULE);
ALTER TABLE AUTORISER ADD CONSTRAINT FK_AUTORISER_ID_TYPE FOREIGN KEY (ID_TYPE) REFERENCES TYPE (ID_TYPE);
ALTER TABLE Association_26 ADD CONSTRAINT FK_Association_26_ID_USER FOREIGN KEY (ID_USER) REFERENCES USER (ID_USER);
ALTER TABLE Association_26 ADD CONSTRAINT FK_Association_26_ID_USER1 FOREIGN KEY (ID_USER1) REFERENCES PROCURATION (ID_USER1);
